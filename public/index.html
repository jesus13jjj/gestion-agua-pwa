<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plataforma AguaComunidad</title>
  <meta name="theme-color" content="#0ea5e9">
  <link rel="manifest" href="manifest.json">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; scroll-behavior: smooth; }
    body { color: #fff; background-color: #002b36; overflow-x: hidden; }

  /* HEADER */
    header {
      position: fixed; top: 0; left: 0; width: 100%;
      background: rgba(0,43,54,0.8); backdrop-filter: blur(8px);
      padding: 20px 60px; display: flex; justify-content: space-between; align-items: center; z-index: 1000;
    }
    /* HEADER */
    header {
      position: fixed; top: 0; left: 0; width: 100%;
      background: rgba(0,43,54,0.8); backdrop-filter: blur(8px);
      padding: 20px 60px; display: flex; justify-content: space-between; align-items: center; z-index: 1000;
    }
    .logo { font-size: 1.5rem; font-weight: bold; color: #00bcd4; }
    nav ul { display: flex; list-style: none; gap: 30px; }
    nav a { color: #fff; text-decoration: none; transition: .3s; }
    nav a:hover { color: #00bcd4; }

    /* HERO */
    .hero {
      height: 100vh;
      background: url('https://images.unsplash.com/photo-1501594907352-04cda38ebc29?auto=format&fit=crop&w=1600&q=80') no-repeat center center/cover;
      display: flex; align-items: center; justify-content: space-between; padding: 100px 60px;
    }
    .hero-content {
      max-width: 600px; background: rgba(0,43,54,0.6); padding: 30px; border-radius: 16px;
    }
    .hero-content h1 { font-size: 3rem; margin-bottom: 20px; line-height: 1.2; }
    .hero-content h1 span { color: #00bcd4; }
    .hero-content p { font-size: 1.1rem; line-height: 1.6; margin-bottom: 25px; }
    .hero-content a { display: inline-block; background: #00bcd4; color: #fff; padding: 12px 28px; border-radius: 30px; text-decoration: none; font-weight: 500; }

    /* LOGIN PANEL */
    .login-form {
      width: 380px; background: rgba(0,43,54,0.85); padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    .login-form h2 { color: #00bcd4; margin-bottom: 10px; font-size: 1.8rem; }
    label { margin-bottom: 5px; display: block; font-weight: 500; }
    input { width: 100%; margin-bottom: 15px; padding: 10px; border-radius: 8px; border: none; outline: none; font-size: 1rem; }
    button { background: #00bcd4; border: none; color: #fff; padding: 10px 20px; border-radius: 30px; font-size: 1rem; cursor: pointer; transition: .3s; }
    button:hover { background: #0097a7; }

    .extra { text-align: center; margin-top: 12px; font-size: 0.95rem; }
    .extra a { color: #00bcd4; text-decoration: none; }
    .extra a:hover { text-decoration: underline; }

    /* INFO (lado izquierdo en layout original) */
    .login-container { display: none; } /* ocultado en esta versi√≥n porque usamos layout de landing */
    .info-box {
      display: none;
    }

    /* SECCIONES */
    section { padding: 100px 60px; }
    #proyectos, #noticias { text-align: center; }
    #proyectos h2, #noticias h2, #contacto h2 { color: #00bcd4; margin-bottom: 40px; font-size: 2rem; }

    .cards { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; }
    .card { background: rgba(0,43,54,0.9); border-radius: 16px; padding: 20px; width: 300px; text-align: left; box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
    .card img { width: 100%; border-radius: 12px; margin-bottom: 15px; }
    .card h3 { color: #00bcd4; margin-bottom: 10px; }
    .card p { font-size: 0.95rem; line-height: 1.5; margin-bottom: 15px; }

    .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px,1fr)); gap: 30px; }
    .news-item { background: rgba(0,43,54,0.85); border-radius: 16px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
    .news-item img { width: 100%; height: 200px; object-fit: cover; }
    .news-item div { padding: 20px; }

  /* MODAL detalles */
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:2000;padding:24px}
  .modal{background:rgba(0,43,54,0.98);max-width:900px;width:100%;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,0.7);overflow:auto;max-height:90vh;border:1px solid rgba(255,255,255,0.03)}
  .modal-header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;border-bottom:1px solid rgba(255,255,255,0.02)}
  .modal-body{padding:20px 22px;color:rgba(230,247,251,0.95);line-height:1.6}
  .modal h3{color:#00c7d8;margin:0}
  .modal .close-btn{background:transparent;border:none;color:#9eeff4;font-size:1.2rem;cursor:pointer;padding:8px}
  .show{display:flex}

    /* CONTACTO */
    #contacto { background: #01313f; text-align: center; }
    form.contact-form { max-width: 500px; margin: auto; background: rgba(0,43,54,0.8); padding: 30px; border-radius: 16px; }
    form.contact-form input, form.contact-form textarea { width: 100%; margin-bottom: 15px; padding: 10px; border-radius: 8px; border: none; outline: none; font-size: 1rem; }

    footer { text-align: center; padding: 20px; background: #001f27; font-size: 0.9rem; }

    @media (max-width:900px) {
      .hero { flex-direction: column; text-align: center; padding: 120px 24px; }
      .login-form { margin-top: 24px; width: 100%; max-width: 420px; }
      section { padding: 70px 20px; }
    }
  </style>
</head>
<body>
  
  <!-- HEADER -->
  <header>
    <div class="logo">üíß AguaComunidad</div>
    <nav>
      <ul>
        <li><a href="#inicio">Inicio</a></li>
        <li><a href="#proyectos">Proyectos</a></li>
        <li><a href="#noticias">Noticias</a></li>
        <li><a href="#contacto">Contacto</a></li>
      </ul>
    </nav>
  </header>

  <!-- HERO (inicio) + LOGIN -->
  <section class="hero" id="inicio">
    <div class="hero-content">
      <h1>Gestiona <span>el agua</span> de tu comunidad</h1>
      <p>Monitorea, reporta incidencias y participa activamente en la gesti√≥n de los recursos h√≠dricos locales. ¬°Contribuye al cuidado del agua desde tu hogar!</p>
      
      <div style="margin-top: 40px; text-align: left;">
      <p style="font-size: 1rem; margin-bottom: 8px;">‚úî Visualiza datos en tiempo real</p>
      <p style="font-size: 1rem; margin-bottom: 8px;">‚úî Reporta incidencias</p>
      <p style="font-size: 1rem; margin-bottom: 8px;">‚úî Participa en decisiones</p>
    </div>

      <a href="#proyectos">Ver proyectos</a>
    </div>

    <div class="login-form" aria-labelledby="login-title">
      <h2 id="login-title">Iniciar sesi√≥n</h2>
      <p style="margin-bottom:12px;">Accede con tu cuenta para gestionar el agua en tu comunidad</p>

      <form id="loginForm">
        <label for="identifier">Correo o tel√©fono</label>
        <input type="text" id="identifier" placeholder="ejemplo@correo.com" required>

        <label for="password">Contrase√±a</label>
        <input type="password" id="password" placeholder="Tu contrase√±a" required>

        <button type="submit">Entrar</button>
      </form>

      <div class="extra" style="margin-top:14px;">
        <p><a href="#" id="forgotPass">¬øOlvidaste tu contrase√±a?</a></p>
        <p>¬øNo tienes cuenta? <a href="#" id="openRegister">Reg√≠strate</a></p>
      </div>
    </div>
  </section>

  <!-- PROYECTOS -->
  <section id="proyectos">
    <h2>Proyectos de Gesti√≥n del Agua</h2>
    <div class="cards">
      <div class="card">
        <img src="https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?auto=format&fit=crop&w=800&q=80" alt="R√≠o Limpio">
        <h3>üíß R√≠o Limpio</h3>
        <p>Campa√±a comunitaria para limpiar y proteger el r√≠o local, con participaci√≥n ciudadana.</p>
        <button class="project-btn" data-id="project-rio">Ver m√°s</button>
      </div>

      <div class="card">
        <img src="https://images.unsplash.com/photo-1583508915901-b5f84c1dcde1?auto=format&fit=crop&w=800&q=80" alt="Medidores Inteligentes">
        <h3>üìä Medidores Inteligentes</h3>
        <p>Implementaci√≥n de sensores IoT para medir el consumo y detectar fugas en tiempo real.</p>
        <button class="project-btn" data-id="project-medidores">Detalles</button>
      </div>

      <div class="card">
        <img src="https://images.unsplash.com/photo-1542744173-8e7e53415bb0?auto=format&fit=crop&w=800&q=80" alt="Escuelas Verdes">
        <h3>üå± Escuelas Verdes</h3>
        <p>Programa educativo para ense√±ar a estudiantes sobre el uso responsable del agua.</p>
        <button class="project-btn" data-id="project-escuelas">Leer m√°s</button>
      </div>
    </div>

  </section>

  <!-- NOTICIAS -->
  <section id="noticias">
    <h2>√öltimas Noticias</h2>
    <div class="news-grid">
      <div class="news-item">
        <img src= "https://media.telemetro.com/p/a52391e98c3e92edb5d9d7162fbac39e/adjuntos/311/imagenes/017/988/0017988165/855x0/smart/aguas-residuales-30ago22.jpeg" alt="Planta de tratamiento inaugurada">
        <div>
          <h3>Planta de tratamiento inaugurada</h3>
          <p>La nueva planta de tratamiento de agua beneficiar√° a m√°s de 5,000 hogares.</p>
          <button class="news-btn" data-id="news-planta">Leer m√°s</button>
        </div>
      </div>

      <div class="news-item">
        <img src="https://images.unsplash.com/photo-1556740749-887f6717d7e4?auto=format&fit=crop&w=800&q=80" alt="Reducci√≥n consumo">
        <div>
          <h3>Reducci√≥n del consumo en 15%</h3>
          <p>Gracias a las campa√±as de concientizaci√≥n, la comunidad logr√≥ reducir el gasto de agua.</p>
          <button class="news-btn" data-id="news-reduccion">Ver noticia</button>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto">
    <h2>Contacto</h2>
    <form class="contact-form" id="contactForm">
      <input type="text" id="contact-name" placeholder="Tu nombre" required>
      <input type="email" id="contact-email" placeholder="Tu correo" required>
      <textarea id="contact-msg" rows="4" placeholder="Escribe tu mensaje..." required></textarea>
      <button type="submit">Enviar mensaje</button>
    </form>
  </section>

  <footer>
    <p>¬© 2025 AguaComunidad ‚Äî Todos los derechos reservados</p>
  </footer>

  <!-- Modal de detalles -->
  <div id="detailModal" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="modalTitle">T√≠tulo</h3>
        <button class="close-btn" id="closeModal" aria-label="Cerrar">‚úï</button>
      </div>
      <div class="modal-body" id="modalBody">
        <p>Contenido...</p>
      </div>
    </div>
  </div>

  <script>
    // API base (ajusta si tu backend est√° en otra URL)
    const API = 'http://localhost:3001';

    // LOGIN
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const identifier = document.getElementById("identifier").value.trim();
      const password   = document.getElementById("password").value;
      if (!identifier || !password) return alert("Completa todos los campos");

      try {
        const res = await fetch(`${API}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ emailOrPhone: identifier, password })
        });
        const data = await res.json();
        if (!res.ok) return alert(data.error || 'Credenciales inv√°lidas');

        localStorage.setItem('token', data.token);
        alert('Inicio de sesi√≥n exitoso');
        window.location.href = './panel.html';
      } catch (err) {
        console.error(err);
        alert('No se pudo conectar con el servidor');
      }
    });

    // REGISTRO - abrir modal
    const openRegisterLink = document.getElementById('openRegister');
    const registerModal = document.createElement('div');
    registerModal.className = 'modal-overlay';
    registerModal.id = 'registerModal';
    registerModal.setAttribute('aria-hidden','true');
    registerModal.innerHTML = `
      <div class="modal" role="document">
        <div class="modal-header">
          <h3>Registro de usuario</h3>
          <button class="close-btn" data-close aria-label="Cerrar">‚úï</button>
        </div>
        <div class="modal-body">
          <form id="registerForm">
            <label for="reg-email">Correo</label>
            <input id="reg-email" type="email" required placeholder="tucorreo@ejemplo.com">
            <label for="reg-password">Contrase√±a</label>
            <input id="reg-password" type="password" required placeholder="M√≠nimo 8 caracteres">
            <label for="reg-name">Nombre (opcional)</label>
            <input id="reg-name" type="text" placeholder="Tu nombre">
            <div style="display:flex;gap:10px;margin-top:14px;">
              <button type="submit" class="btn">Registrarse</button>
              <button type="button" class="btn secondary" data-close>Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    `;
    document.body.appendChild(registerModal);

    function openRegisterModal(){ registerModal.classList.add('show'); registerModal.setAttribute('aria-hidden','false'); document.getElementById('reg-email').focus(); }
    function closeRegisterModal(){ registerModal.classList.remove('show'); registerModal.setAttribute('aria-hidden','true'); }
    openRegisterLink.addEventListener('click', (e)=>{ e.preventDefault(); openRegisterModal(); });
    registerModal.addEventListener('click', (e)=>{ if (e.target === registerModal || e.target.dataset.close !== undefined) closeRegisterModal(); });

    document.getElementById('registerForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('reg-email').value.trim();
      const password = document.getElementById('reg-password').value;
      const full_name = document.getElementById('reg-name').value.trim();
      if (!email || !password) return alert('Completa correo y contrase√±a');
      try{
        const res = await fetch(`${API}/auth/register`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email, password, full_name }) });
        const data = await res.json();
        if (!res.ok) return alert(data.error || 'No se pudo registrar');
        alert('Usuario creado. Ahora inicia sesi√≥n.');
        closeRegisterModal();
      }catch(err){ console.error(err); alert('Error al registrar usuario'); }
    });

    // RECUPERAR CONTRASE√ëA - modal
    const forgotLink = document.getElementById('forgotPass');
    const forgotModal = document.createElement('div');
    forgotModal.className = 'modal-overlay';
    forgotModal.id = 'forgotModal';
    forgotModal.setAttribute('aria-hidden','true');
    forgotModal.innerHTML = `
      <div class="modal" role="document">
        <div class="modal-header">
          <h3>Recuperar contrase√±a</h3>
          <button class="close-btn" data-close aria-label="Cerrar">‚úï</button>
        </div>
        <div class="modal-body">
          <form id="forgotForm">
            <label for="forgot-email">Introduce tu correo</label>
            <input id="forgot-email" type="email" required placeholder="tucorreo@ejemplo.com">
            <div style="display:flex;gap:10px;margin-top:14px;">
              <button type="submit" class="btn">Enviar enlace</button>
              <button type="button" class="btn secondary" data-close>Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    `;
    document.body.appendChild(forgotModal);
    function openForgot(){ forgotModal.classList.add('show'); forgotModal.setAttribute('aria-hidden','false'); document.getElementById('forgot-email').focus(); }
    function closeForgot(){ forgotModal.classList.remove('show'); forgotModal.setAttribute('aria-hidden','true'); }
    forgotLink.addEventListener('click', (e)=>{ e.preventDefault(); openForgot(); });
    forgotModal.addEventListener('click', (e)=>{ if (e.target === forgotModal || e.target.dataset.close !== undefined) closeForgot(); });

    document.getElementById('forgotForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('forgot-email').value.trim();
      if (!email) return alert('Introduce un correo v√°lido');
      try{
        // ejemplo de llamada al backend
        // await fetch(`${API}/auth/forgot`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email }) });
        alert(`Si el correo ${email} existe en nuestro sistema, recibir√°s un enlace para restablecer la contrase√±a.`);
        closeForgot();
      }catch(err){ console.error(err); alert('No se pudo procesar la solicitud'); }
    });

    // Contenido detallado para proyectos y noticias
    const DETAILS = {
      'project-rio': {
        title: 'R√≠o Limpio ‚Äî Campa√±a comunitaria',
        html: `
          <p>La iniciativa "R√≠o Limpio" tiene como objetivo principal recuperar la calidad del cauce mediante jornadas de limpieza, instalaci√≥n de se√±alizaci√≥n y educaci√≥n ambiental. El proyecto incluye:</p>
          <ul>
            <li>Jornadas mensuales de limpieza con voluntarios.</li>
            <li>Instalaci√≥n de puntos de recolecci√≥n y contenedores cerca del r√≠o.</li>
            <li>Monitoreo de la calidad del agua con sensores b√°sicos y muestreos peri√≥dicos.</li>
            <li>Programas educativos para escuelas y vecinos.</li>
          </ul>
          <p>Resultados esperados: reducci√≥n de residuos en el cauce, mejora de la biodiversidad local y mayor concienciaci√≥n ciudadana.</p>
        `
      },
      'project-medidores': {
        title: 'Medidores Inteligentes ‚Äî IoT para detecci√≥n de fugas',
        html: `
          <p>Este proyecto instala medidores inteligentes en puntos clave para medir consumo y detectar anomal√≠as que puedan indicar fugas o fraudes.</p>
          <p>Componentes:</p>
          <ol>
            <li>Sensores de flujo conectados por NB-IoT/LoRa.</li>
            <li>Plataforma central que ingiere los datos y genera alertas autom√°ticas.</li>
            <li>Panel para usuarios y administradores con gr√°ficos de consumo y notificaciones.</li>
          </ol>
          <p>Beneficios: detecci√≥n temprana de fugas, ahorro de agua y mejora en la facturaci√≥n.</p>
        `
      },
      'project-escuelas': {
        title: 'Escuelas Verdes ‚Äî Educaci√≥n y responsabilidad',
        html: `
          <p>"Escuelas Verdes" es un programa educativo que integra actividades pr√°cticas para ense√±ar el uso responsable del agua:</p>
          <ul>
            <li>Talleres con experimentos sobre ciclo del agua.</li>
            <li>Proyectos escolares para reducir consumo (huertos, reuso de aguas grises).</li>
            <li>Concursos y ferias ambientales para incentivar participaci√≥n.</li>
          </ul>
          <p>El enfoque es pr√°ctico y colaborativo, involucrando docentes, estudiantes y familias.</p>
        `
      },
      'news-planta': {
        title: 'Planta de tratamiento inaugurada',
        html: `
          <p>La nueva planta de tratamiento cuenta con tecnolog√≠a de proceso secundario y sistemas de desinfecci√≥n que permitir√°n mejorar la calidad del agua devuelta al medio y aumentar la disponibilidad para uso humano y riego.</p>
          <p>Capacidad: 5,000 m3/d√≠a. Impacto estimado: beneficiar√° a m√°s de 5,000 hogares en la regi√≥n, reducir√° descargas contaminantes y permitir√° la reutilizaci√≥n segura.</p>
        `
      },
      'news-reduccion': {
        title: 'Reducci√≥n del consumo en 15%',
        html: `
          <p>Gracias a campa√±as de concientizaci√≥n y programas de eficiencia, la comunidad logr√≥ una reducci√≥n promedio del 15% en consumo residencial.</p>
          <p>Medidas implementadas: instalaci√≥n de aireadores, reparaci√≥n de fugas domiciliarias y talleres de uso eficiente.</p>
        `
      }
    };

    // Modal
    const modal = document.getElementById('detailModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const closeModalBtn = document.getElementById('closeModal');

    function openModal(id){
      const d = DETAILS[id];
      if (!d) return;
      modalTitle.textContent = d.title;
      modalBody.innerHTML = d.html;
      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');
      // set focus
      closeModalBtn.focus();
    }

    function closeModal(){
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
      modalTitle.textContent = '';
      modalBody.innerHTML = '';
    }

    // Botones de proyectos y noticias
    document.querySelectorAll('.project-btn, .news-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const id = e.currentTarget.dataset.id;
        if (id) openModal(id);
      });
    });

    // Cerrar modal
    closeModalBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.classList.contains('show')) closeModal(); });

    // CONTACTO - ejemplo de env√≠o local (simulado)
    document.getElementById('contactForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('contact-name').value.trim();
      const email = document.getElementById('contact-email').value.trim();
      const msg = document.getElementById('contact-msg').value.trim();
      if (!name || !email || !msg) return alert('Completa todos los campos');

      try {
        // aqu√≠ podr√≠as enviar a tu API: await fetch(`${API}/contact`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ name, email, msg }) })
        alert('Mensaje enviado. Gracias por contactarnos.');
        document.getElementById('contactForm').reset();
      } catch (err) {
        console.error(err);
        alert('No se pudo enviar el mensaje');
      }
    });

    // Registrar Service Worker (opcional)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker?.register('/service-worker.js')
          .then(() => console.log('Service Worker registrado'))
          .catch(err => console.error('Error al registrar SW:', err));
      });
    }
  </script>
</body>
</html>
